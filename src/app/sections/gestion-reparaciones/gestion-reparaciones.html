<!--
  Archivo: gestion-reparaciones.html
  Objetivo:
  - Listar √≥rdenes con filtros y acciones.
  - Cumplir accesibilidad (ESLint): click-events-have-key-events e interactive-supports-focus.
  - Usar el modal como componente standalone (app-orden-detalle-modal).
  Notas:
  - Aseg√∫rate de importar OrdenDetalleModal en @Component.imports del TS.
  - Evitar <span>/<div> con (click): usar <button> o <a> nativos.
-->

<section class="page-wrap min-h-screen bg-[#0D1117] p-8 flex flex-col items-center">
  <!-- T√≠tulo -->
  <h2 id="titulo" class="text-3xl font-bold mb-8 text-white text-center">
    √ìrdenes registradas
  </h2>

  <!-- Contenedor principal -->
  <div class="bg-gray-900/90 rounded-lg shadow-lg border border-white/10 p-6 w-full max-w-[95%] mx-auto">

    <!-- Filtros -->
    <div class="flex flex-wrap gap-4 mb-6 text-white">
      <div class="w-full sm:w-40">
        <label for="estadoFiltro" class="block mb-1 text-sm">Estado:</label>
        <select
          id="estadoFiltro"
          [(ngModel)]="estadoFiltro"
          class="w-full bg-gray-800 text-white rounded-md p-2 focus:ring-2 focus:ring-cyan-400"
        >
          <option value="">Todos</option>
          <option value="Recibido">Recibido</option>
          <option value="En proceso">En proceso</option>
          <option value="Finalizado">Finalizado</option>
        </select>
      </div>

      <div class="w-full sm:w-40">
        <label for="prioridadFiltro" class="block mb-1 text-sm">Prioridad:</label>
        <select
          id="prioridadFiltro"
          [(ngModel)]="prioridadFiltro"
          class="w-full bg-gray-800 text-white rounded-md p-2 focus:ring-2 focus:ring-cyan-400"
        >
          <option value="">Todas</option>
          <option value="Alta">Alta</option>
          <option value="Media">Media</option>
          <option value="Baja">Baja</option>
        </select>
      </div>

      <div class="w-full sm:w-64">
        <label for="clienteFiltro" class="block mb-1 text-sm">Cliente:</label>
        <input
          id="clienteFiltro"
          [(ngModel)]="clienteFiltro"
          placeholder="Buscar cliente..."
          class="w-full bg-gray-800 text-white rounded-md p-2 focus:ring-2 focus:ring-cyan-400"
        />
      </div>
    </div>

    <!-- Tabla -->
    <div class="overflow-x-auto">
      <table class="min-w-[1400px] w-full text-sm text-white text-center">
        <thead class="bg-gray-800 text-blue-400">
          <tr>
            <th class="px-4 py-2">Cliente</th>
            <th class="px-4 py-2">Tel√©fono</th>
            <th class="px-4 py-2">Direcci√≥n</th>
            <th class="px-4 py-2">Tipo</th>
            <th class="px-4 py-2">Marca</th>
            <th class="px-4 py-2">Modelo</th>
            <th class="px-4 py-2">Accesorios</th>
            <th class="px-4 py-2">Condiciones</th>
            <th class="px-4 py-2">Descripci√≥n</th>
            <th class="px-4 py-2">Falla</th>
            <th class="px-4 py-2">Diagn√≥stico</th>
            <th class="px-4 py-2">Estado</th>
            <th class="px-4 py-2">Prioridad</th>
            <th class="px-4 py-2">Ingreso</th>
            <th class="px-4 py-2">Entrega</th>
            <th class="px-4 py-2">Finalizaci√≥n</th>
            <th class="px-4 py-2">Presupuesto</th>
            <th class="px-4 py-2">Costo</th>
            <th class="px-4 py-2">Forma de pago</th>
            <th class="px-4 py-2">Autorizaci√≥n</th>
            <th class="px-4 py-2">Notas</th>
            <th class="px-4 py-2">Historial</th>
            <th class="px-4 py-2">Acciones</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-white/10">
          @for (orden of ordenesFiltradas; track $index) {
            <tr>
              <td class="px-4 py-2">{{ orden.cliente.nombre }}</td>
              <td class="px-4 py-2">{{ orden.cliente.telefono }}</td>
              <td class="px-4 py-2">{{ orden.cliente.direccion }}</td>

              <td class="px-4 py-2">{{ orden.dispositivo.tipo }}</td>
              <td class="px-4 py-2">{{ orden.dispositivo.marca }}</td>
              <td class="px-4 py-2">{{ orden.dispositivo.modelo }}</td>
              <td class="px-4 py-2">{{ orden.dispositivo.accesorios }}</td>
              <td class="px-4 py-2">{{ orden.dispositivo.condiciones }}</td>
              <td class="px-4 py-2">{{ orden.dispositivo.descripcionAdicional }}</td>

              <td class="px-4 py-2">{{ orden.informacion.falla }}</td>
              <td class="px-4 py-2">{{ orden.informacion.diagnostico }}</td>

              <!-- Estado con badge -->
              <td class="px-4 py-2">
                <span
                  class="inline-block px-3 py-1 rounded-md font-semibold text-xs text-white shadow"
                  [ngClass]="{
                    'bg-gradient-to-r from-blue-500 to-blue-600': orden.informacion.estado === 'Recibido',
                    'bg-gradient-to-r from-yellow-400 to-orange-500': orden.informacion.estado === 'En proceso',
                    'bg-gradient-to-r from-emerald-500 to-teal-400': orden.informacion.estado === 'Finalizado'
                  }"
                >
                  {{ orden.informacion.estado }}
                </span>
              </td>

              <!-- Prioridad con badge -->
              <td class="px-4 py-2">
                <span
                  class="inline-block px-3 py-1 rounded-md font-semibold text-xs text-white shadow"
                  [ngClass]="{
                    'bg-gradient-to-r from-red-500 to-red-600': orden.informacion.prioridad === 'Alta',
                    'bg-gradient-to-r from-orange-500 to-yellow-400': orden.informacion.prioridad === 'Media',
                    'bg-gradient-to-r from-green-500 to-teal-400': orden.informacion.prioridad === 'Baja'
                  }"
                >
                  {{ orden.informacion.prioridad }}
                </span>
              </td>

              <td class="px-4 py-2">{{ orden.informacion.fechaIngreso }}</td>
              <td class="px-4 py-2">{{ orden.informacion.fechaEntrega }}</td>
              <td class="px-4 py-2">{{ orden.informacion.fechaFinalizacion }}</td>

              <td class="px-4 py-2">{{ orden.costos.presupuesto }}</td>
              <td class="px-4 py-2">{{ orden.costos.costoFinal | currency:'USD' }}</td>
              <td class="px-4 py-2">{{ orden.costos.formaPago }}</td>
              <td class="px-4 py-2">{{ orden.costos.autorizacion ? 'S√≠' : 'No' }}</td>

              <td class="px-4 py-2">{{ orden.seguimiento.notasInternas }}</td>
              <td class="px-4 py-2">{{ orden.seguimiento.historial }}</td>

              <!-- Acciones accesibles -->
              <td class="px-4 py-2">
                <div class="flex justify-center gap-2">
                  <a
                    [routerLink]="['/ordenes', orden.id, 'editar']"
                    class="text-blue-400 px-2 py-1 rounded hover:bg-white/10"
                    aria-label="Editar orden"
                  >
                    ‚úèÔ∏è
                  </a>

                  <button
                    type="button"
                    (click)="eliminarOrden($index)"
                    class="text-red-500 px-2 py-1 rounded hover:bg-white/10"
                    aria-label="Eliminar orden"
                  >
                    üóëÔ∏è
                  </button>

                  <button
                    type="button"
                    (click)="verOrden($index)"
                    class="text-green-400 px-2 py-1 rounded hover:bg-white/10"
                    aria-label="Ver detalle"
                  >
                    üëÅÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal standalone (aseg√∫rate de importarlo en el TS) -->
@if (modalVisible && ordenSeleccionada) {
  <app-orden-detalle-modal
    [orden]="ordenSeleccionada"
    (cerrar)="cerrarModal()">
  </app-orden-detalle-modal>
}
</section>